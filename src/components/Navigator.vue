<script setup lang="ts">
    import { useI18n } from "vue-i18n";
    import { ref, computed } from "vue";
    import IconZh from "~icons/circle-flags/zh";
    import IconEnUs from "~icons/circle-flags/en-us";

    const { locale } = useI18n();
    const languages = ref([
        { code: "zh_CN", name: "简体中文（中国大陆）", icon: IconZh },
        { code: "en_US", name: "English (Incomplete)", icon: IconEnUs },
    ]);

    const sortedLanguages = computed(() => {
        return [...languages.value].sort((a, b) => {
            return a.code === locale.value ? -1 : b.code === locale.value ? 1 : 0;
        });
    });

    const changeLocale = (newLocale: string) => {
        locale.value = newLocale;
    };
</script>

<template>
    <header class="fixed w-full h-12 md:h-3/50 px-2 md:px-4 bg-base-100 z-100 flex justify-end-safe items-center">
        <svg viewBox="0 0 312 75" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-6 md:h-1/2 text-base-content">
            <path
                d="M186.35 44.16C185.03 45.69 183.72 47.09 182.42 48.36C177.66 53 173.6 55.31 170.25 55.31C167.81 55.31 165.92 54.38 164.59 52.5Q164.55 52.44 164.51 52.39Q162.59 49.59 162.98 45.14Q163.2 42.58 164.55 37.91L173.5 6.72C172.67 6.84 171.96 6.91 171.36 6.91C166.57 6.91 164.34 4.91 164.69 0.93L164.75 0.21C167.13 1.62 169.89 2.33 173.04 2.33Q176.87 2.33 180.05 0.79Q180.79 0.43 181.49 0L170.97 37.45C170.03 40.81 169.5 43.12 169.39 44.39C169.08 47.9 170.22 49.65 172.8 49.65Q176.55 49.65 180.72 45.43Q182.94 43.19 186.77 38.23Q187.21 36.3 188.05 34.51Q189.62 31.16 192.56 28.36Q195.92 25.15 199.77 23.87L199.77 23.87Q202.31 23.03 205.07 23.03Q206.13 23.03 207.3 23.31C206.86 22.38 206.67 21.59 206.72 20.95C206.81 19.95 207.24 19 208 18.08C213.05 18.5 217.05 21.09 220.01 25.86C223.26 28.21 226.77 29.38 230.52 29.38C232.38 29.38 234.39 28.91 236.57 27.95C236.59 27.76 236.61 27.57 236.63 27.39C236.73 26.19 236.48 25.18 235.86 24.37Q239.24 23.25 241.3 23.25C242.76 23.25 243.41 24.17 243.25 26.02C243.15 27.16 242.36 30.16 240.9 35.02L238.32 44.08C242.93 36.46 247.41 30.54 251.77 26.32C256.13 22.09 259.93 19.98 263.18 19.98C264.33 19.98 265.29 20.31 266.06 20.96C266.84 21.62 267.19 22.41 267.11 23.34C266.98 24.8 265.23 26.73 261.85 29.13C261.2 27.49 260.15 26.67 258.69 26.67Q254.72 26.67 247.83 35.08C244.98 38.57 242.46 42.16 240.26 45.87Q236.96 51.42 236.75 53.79L236.74 54.32C235.27 54.98 234.1 55.31 233.25 55.31Q231.45 55.31 230.75 54.43Q230.2 53.74 230.3 52.51Q230.43 51.08 232.05 45.38L234.29 37.63C234.96 35.38 235.48 33.42 235.87 31.74C233.73 32.6 231.6 33.03 229.48 33.03C227.17 33.03 224.58 32.55 221.73 31.59C221.75 32.09 221.74 32.54 221.7 32.93C221.18 38.93 218.68 44.16 214.21 48.62C209.73 53.08 204.76 55.31 199.28 55.31C195.09 55.31 191.8 53.98 189.39 51.31C187.63 49.36 186.62 46.97 186.35 44.16ZM92.33 34.33L91.38 35.27Q79.79 46.6 78.43 55.69L76.78 54.6C74.75 53.29 73.78 52.1 73.87 51.02Q74.07 48.78 78.69 43.33C81.76 39.7 85.25 36.26 89.13 33.03L91.02 31.44L90.33 30.04C89.08 27.63 87.87 24.35 86.68 20.2C85.49 16.05 84.96 13.27 85.08 11.86C85.26 9.84 86.73 8.4 89.49 7.53L91 7.06C90.97 9.01 91.51 12.05 92.61 16.18C93.7 20.31 94.89 23.77 96.17 26.55L96.67 27.64L97.76 26.89C100.79 24.73 103.36 22.1 105.47 19Q108.64 14.35 108.99 10.42C109.03 9.91 109.01 9.37 108.91 8.81L109.79 8.37C111.21 7.66 112.54 7.31 113.79 7.31C115.06 7.31 115.64 7.96 115.52 9.27Q115.18 13.19 110.51 18.95Q105.83 24.71 98.93 29.69L97.92 30.44L98.44 31.69C100.11 35.65 102.43 39.57 105.38 43.45C107.25 45.9 108.82 47.55 110.09 48.39Q111.99 49.65 114.8 49.65C115.58 49.65 116.48 49.45 117.51 49.06Q113.17 55.13 109.48 55.13Q105.73 55.13 100.66 48.81C99.55 47.44 98.11 45.25 96.33 42.26Q93.66 37.76 92.87 35.7L92.33 34.33ZM127.23 52.61L123.94 64.12C123.2 66.72 122.74 68.98 122.57 70.91C122.46 72.14 122.64 73.25 123.09 74.24C120.93 74.93 119.29 75.27 118.19 75.27C116.46 75.27 115.68 74.29 115.85 72.34C115.98 70.83 116.54 68.35 117.53 64.9L130.66 19.2C128.81 19.58 127.27 19.76 126.04 19.76C124.23 19.76 122.93 19.33 122.14 18.47C121.35 17.61 120.8 16.01 120.48 13.66C121.92 14.68 124.18 15.19 127.29 15.19C131.14 15.19 134.91 14.48 138.6 13.07L135.14 25.09C138.98 21.68 142.8 19.98 146.59 19.98C149.9 19.98 152.55 21.23 154.54 23.73C156.53 26.23 157.36 29.35 157.03 33.09Q156.66 37.39 154.86 41.12Q153 44.96 149.62 48.19Q145.74 51.89 141.28 53.43Q138.09 54.54 134.6 54.54C131.58 54.54 129.12 53.89 127.23 52.61ZM69.88 31.59C69.9 32.09 69.9 32.54 69.86 32.93C69.34 38.93 66.84 44.16 62.36 48.62C57.89 53.08 52.91 55.31 47.43 55.31Q43.17 55.31 40.14 53.47Q38.71 52.6 37.55 51.31C35.15 48.65 34.13 45.19 34.5 40.93Q34.8 37.51 36.21 34.51Q37.77 31.16 40.71 28.36Q44.07 25.15 47.93 23.87Q50.47 23.03 53.23 23.03Q54.29 23.03 55.45 23.31C55.01 22.38 54.82 21.59 54.88 20.95C54.97 19.95 55.39 19 56.16 18.08Q58.51 18.28 60.57 19.1Q65.11 20.93 68.17 25.86C71.42 28.21 74.92 29.38 78.67 29.38C81.11 29.38 83.82 28.56 86.79 26.92L88.12 29.57C84.61 31.87 81.11 33.03 77.63 33.03C75.32 33.03 72.74 32.55 69.88 31.59ZM7.15 55.38C7.76 53.55 8.13 51.97 8.25 50.65Q8.92 42.96 6.45 33.65Q3.99 24.34 0 19.61C1.89 18.69 3.55 18.24 4.99 18.24Q8.43 18.24 11.16 27.22Q13.89 36.2 14.3 48.93Q20.38 42.02 24.58 34.68Q28.79 27.33 29.72 22C32.74 23.25 34.18 24.66 34.04 26.24Q33.85 28.36 28.72 35.83Q23.58 43.3 17.75 49.96C15.85 52.12 14.29 53.51 13.07 54.13C11.85 54.75 9.87 55.17 7.15 55.38ZM271.2 41.59C270.67 47.67 272.98 50.71 278.15 50.71Q284.87 50.71 293.52 44.33C299.29 40.07 304.64 34.47 309.58 27.51L312.11 28.98C307.37 36.57 301.51 42.86 294.54 47.84C287.57 52.82 281.16 55.31 275.31 55.31C271.56 55.31 268.7 54.11 266.73 51.7C264.77 49.3 263.97 46.01 264.33 41.84C264.86 35.82 267.28 30.67 271.6 26.39C275.93 22.12 280.87 19.98 286.43 19.98C289.12 19.98 291.21 20.66 292.71 22C294.2 23.35 294.85 25.16 294.66 27.42C294.33 31.14 291.8 34.43 287.06 37.29C282.32 40.15 277.03 41.59 271.2 41.59ZM271.71 38.6Q277.38 38.3 281.86 35.73Q282.56 35.32 283.24 34.86C286.55 32.6 288.34 29.98 288.6 27.02C288.83 24.36 287.76 23.03 285.38 23.03C282.55 23.03 279.8 24.55 277.14 27.58C274.48 30.61 272.67 34.28 271.71 38.6ZM128.62 47.78C130.51 50.23 132.99 51.45 136.05 51.45C139.72 51.45 142.97 49.92 145.82 46.85C148.66 43.78 150.27 40.04 150.66 35.64C150.93 32.46 150.43 29.89 149.14 27.92C147.86 25.95 146.05 24.96 143.71 24.96C140.8 24.96 137.49 26.6 133.78 29.88L128.62 47.78ZM63.02 28.95C61.34 28.43 59.82 27.6 58.46 26.46C57.42 26.23 56.54 26.11 55.83 26.11Q54.44 26.11 53.09 26.44L53.09 26.44Q49.33 27.37 45.99 30.88C42.98 34.05 41.29 37.67 40.93 41.74C40.68 44.69 41.29 47.11 42.78 49.01C44.27 50.91 46.32 51.86 48.92 51.86Q50.26 51.86 51.54 51.52Q55.29 50.51 58.48 46.55C61.33 43.01 62.97 38.79 63.4 33.9C63.55 32.19 63.42 30.55 63.02 28.95ZM214.87 28.95C213.18 28.43 211.66 27.6 210.3 26.46C209.26 26.23 208.38 26.11 207.68 26.11Q206.28 26.11 204.94 26.44Q201.17 27.37 197.84 30.88C194.82 34.05 193.13 37.67 192.78 41.74C192.52 44.69 193.14 47.11 194.63 49.01C196.12 50.91 198.16 51.86 200.77 51.86Q202.11 51.86 203.39 51.52Q207.13 50.51 210.33 46.55C213.18 43.01 214.82 38.79 215.25 33.9C215.39 32.19 215.27 30.55 214.87 28.95Z"
                fill="currentColor"
                fill-opacity="1"
                fill-rule="evenodd" />
        </svg>
        <div class="ml-auto"></div>
        <button class="btn btn-square" popovertarget="popover-1" style="anchor-name: --anchor-dropdown-lang">
            <i class="icon-[material-symbols--language] size-6"></i>
        </button>
        <ul
            class="dropdown dropdown-end menu rounded-sm bg-base-200 border border-base-content/50 shadow-sm"
            popover
            id="popover-1"
            style="position-anchor: --anchor-dropdown-lang">
            <li v-for="lang in sortedLanguages" :key="lang.code">
                <button @click="changeLocale(lang.code)" class="flex" :class="{ 'btn-disabled': lang.code === locale }">
                    <component :is="lang.icon" />
                    {{ lang.name }}
                </button>
            </li>
        </ul>
    </header>
</template>

<style lang="css" scoped>
    .btn-disabled {
        background-color: color-mix(in oklab, var(--color-base-content) 10%, transparent);
        box-shadow: none;
        pointer-events: none;
        border-color: #0000;
        --noise: none;
        color: color-mix(in oklch, var(--color-base-content) 20%, #0000);
        @media (hover: hover) {
            &:hover {
                pointer-events: none;
                background-color: color-mix(in oklab, var(--color-neutral) 20%, transparent);
                border-color: #0000;
                color: color-mix(in oklch, var(--color-base-content) 20%, #0000);
            }
        }
    }
</style>
